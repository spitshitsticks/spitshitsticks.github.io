Имеем рекламную кампанию, в которой рекламируется 2 продукта A и B. Продукт A
выплачивает $5 за каждую конверсию, продукт B - $8.
По результатам теста видим, что продукт B имеет EPC (earning per click) почти
в 1.5 раза больше, чем A.
Внимание вопрос, продукт B лучше чем продукт A?

| Offer | Clicks | Conversions |   Revenue |   CTR |   EPC |
|-------|-------:|------------:|----------:|------:|------:|
| A     |    235 |           7 |    $56.00 | 2.98% | $0.24 |
| B     |   6928 |         451 |  $2255.00 | 6.51% | $0.33 |

Чисто математически - нет.

Внимательные обратили внимание, что на A ушло значительно меньше кликов и, сам продукт платит выше,
значит и вероятность конверсии на нем ниже, поскольку воронка сложнее.

Вероятность выпадения орла или решки при броске монеты равна 50%. Но орлы и решки не выпадают по очереди
(орел-решка-орел-решка-...). Если пробрасывать монету очень долго, то иногда будут выпадать длинные серии
из орлов и решек. Так работает случайность и об этом нужно помнить.

То же самое и с кликами и конверсиями. Они никогда не будут выпадать равномерно. Иногда будут длинные серии
из кликов без конверсий, иногда наоборот.

Давайте предположим, что у продукта A на самом деле ровно такой же EPC, как и у продукта B,
а затем попробуем посчитать вероятность того, что мы чисто случайно получили такие результаты как мы видим. 

Для того, что бы на продукте А у нас был EPC в $0.33, нам нужно, чтобы количество конверсий там было
($0.33*235)/$8=9.69 (мы математики, у нас количество конверсий может быть дробным числом). Тогда вероятность
того, что конкретно взятый клик приведет к конверсии равна 9.69/235=4.12%. Это наша монетка, которая с
вероятностью 4.12% выпадает конверсией и с вероятностью 95.88% не выпадает.

Поскольку дальше начинается не совсем простая математика, давайте вместо цифр и формул воспользуемся методом
Монте-Карло и просто смоделируем эксперимент, в котором мы подбросим нашу монетку 235 раз и посмотрим,
сколько она выдаст конверсий.

```python
import numpy as np
np.sum(np.random.rand(235) < 0.0412)
```
У меня получилось 11, у кого-то может больше или меньше. Но это нам еще ни о чем не говорит, потому что это
всего один эксперимент. Давайте повторим этот же самый эксперимент много раз и посмотри сколько конверсий
будет выпадать в каждом из них.

```python
import pandas as pd

all_conversions = []
for i in range(100000):
    conversions = np.sum(np.random.rand(235) < 0.0412)
    all_conversions.append(conversions)

sns.histplot(all_conversions)
```

![](/assets/monte-carlo-1.png)


Мы видим, что количество конверсий равное 7 (как в изначальных данных) либо меньше выпадает, в общем-то,
достаточно дофига часто. А если быть точнее 24609 раз:

```python
np.sum(np.array(all_conversions) <= 7) # 24609
```

Т.е. простыми словами, если предположить, что EPC у продукта A равен $0.33, то пытаясь сделать выводы
основываясь на 235 кликах мы почти в четверти случаев будем ошибочно предполагать, что EPC ниже либо
равен $0.24 просто из-за того, что магнитные бури сегодня такие.