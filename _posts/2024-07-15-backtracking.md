---
layout: post
title: "Backtracking алгоритм"
author: "Evgeniy Petrov"
---

На выходных пришлось побыть немного Христо Грозевым.

На почту компании пришло письмо. Вообще вот, казалось бы, зачем компании сайт, на котором будет еще и контактный имейл,
если все, кто потенциально может туда написать, и так знают, к кому обратиться. Оказалось, что очень даже и нужен.
Человек жаловался, что наша компания, скажем так, настойчиво рекламирует свои услуги без возможности отказаться от этой
рекламы и прикрепил пример, где была видна та самая реклама (очень похожая на нашу) с именем и адресом нашей компании.

Мы тоже рекламируем свои услуги, но не делаем это так настойчиво и точно не будем продолжать это делать, если кто-то не
хочет. Поэтому первая мысль была, что что-то сломалось, однако быстро стало понятно, что данная активность нами
инициирована не была. И я полез копать.

Вообще мы работаем в такой отрасли, где все друг у друга "вдохновляются" креативами. Все к этому уже давно привыкли, и
обычно это не большая проблема, даже наоборот, с какой-то точки зрения, если кто-то "вдохновился" твоим креативом, это
уже признак определенного уровня! Но есть понятие этики - ставить имя чужой компании - плохо. Поэтому нужно разобраться.

Казалось бы, при чем тут Backtracking? Backtracking - это такое семейство алгоритмов, которые позволяют найти решение
путем последовательного построения списка потенциальных кандидатов на решение и путем отсечения кандидатов сразу, как
становится ясно, что этот кандидат не может быть решением. Например, если кто-то когда-то разгадывал судоку или японские
кроссворды - вы это делали именно с помощью backtracking алгоритма. Еще некоторые реализации регулярных выражений (
например, в Go) используют этот алгоритм.

В данном случае я использовал тот же самый подход. Забегая вперед, виновник был найден, и была проведена беседа. В
ситуации, когда один что-то скрывает, а второй пытается это найти, у первого всегда преимущество, потому что малейшая
упущенная его "соперником" деталь дает первому очень много дополнительной информации. Чем дольше вы что-то ищете, тем
больше у вас информации и тем быстрее вы это найдете. Вопрос в том, как долго вы готовы искать и сколько ресурсов готовы
на это потратить. По этой причине те, кто занимаются разными темными схемами типа спама или клоакингом, должны понимать
одну вещь: вас не поймали либо потому, что кого-то было поймать чуть проще, чем вас, либо потому, что вас пока выгодно
не ловить. Разные гуглы и фейсбуки все про вас хорошо знают.

Не буду писать, как именно я нашел, но приведу несколько трюков, которые я использовал.

Разумеется, все начинается с внешних ссылок. От рекламы, которая никуда не ведет, мало толку, поэтому для начала просто
переходим и смотрим, куда ведут ссылки, они ведут на какие-то случайные продукты через миллионы редиректов. Вам
понадобятся разные прокси, эмулятор устройств и немного терпения. Смотрим все редиректы и выписываем их в отдельный
файлик и повторяем эксперимент много раз, используя разные прокси устройства.

Очень вероятно, что первые несколько редиректов будут очень похожими - можно предположить, что они все управляются тем,
кого вы ищете. Какую информацию можно вытащить из одних только редиректов? Очень много - имя домена, зона домена (
например, активное использование зоны .ru вполне может отсеять половину подозреваемых), IP адрес сервера,
хостинг-провайдер, данные whois, данные DNS, трекинг-параметры (обязательно раскодируйте все base64 encoded поля). По
финальным продуктам можно составить определенный портрет того, чем занимается ваш подозреваемый, даже по тому, насколько
качественно все сделано, можно сделать вывод, что этому уделили достаточно много времени и это определенно делалось не
одним человеком а большой командой.

Между редиректами у вас обязательно будут какие-то страницы, где вам стоит обратить внимание на то, какие технологии
используются, есть ли какие-то элементы на страницах, которые вы уже "где-то видели", ищите разные дебаги, трекеры
ошибок, API, проверяйте все, ищите IP, которые находятся не за CDN, ищите разные технические домены. Какой-нибудь
джуниор-программист однажды обязательно оставит вам "подсказку" сам о том не подозревая. Даже если вы не сможете
установить владельца IP, всегда можно написать провайдеру abuse-report, чтобы до владельца дошла информация, что вы
глубоко обеспокоены.

Дальше, когда вы собрали все эти данные, их можно сделать еще больше. Например, по IP адресу можно сделать reverse
lookup и посмотреть, какие другие сайты хостятся на том же IP. Для этого можно использовать как внешние сервисы, так и
сделать на коленках свой, для этого только желательно ограничить список проверяемых сайтов от всего интернета до сайтов,
которые потенциально могут использовать люди из вашей отрасли.

Даже если IP находится за Cloudflare, не все потеряно, можно посмотреть NS где припаркован домен. Они обычно разные, но
Cloudflare всегда для одного аккаунта делает одинаковую пару NS серверов. Одна и та же пара скорее всего будет у сотен
тысяч других аккаунтов, но таких, которые будут еще и заниматься тем же, чем и вы, уже будет сильно меньше.

Погуглите каждый IP, домен и ссылку, которые найдете, возможно, они засветились еще где-то. Посмотрите потоки входящего
и исходящего трафика на этих доменах через similarweb.com или ему подобным. Зайдите на них и посмотрите что там
хостится.

Используйте внешние базы данных и собирайте свои данные, они вам очень понадобятся в будущем. Вы можете уехать из
Запорожья, но Запорожье из вас никуда не уедет. Домены и IP могут меняться, но что-то обязательно поменять забудут.
Ищите паттерны в исторических данных, которые могут указать вам на следующую подсказку. Ищите и найдете.

Персонажи и события вымышлены, все совпадения случайны.